<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Page 2 | Jeon, an engineer</title>
  <meta name="author" content="Seokseong Jeon">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jeon, an engineer"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeon, an engineer</a></h1>
  <h2><a href="/">Write the unwritten</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a target="_blank" rel="noopener" href="https://github.com/internalstability/hexo-src/issues/new">✒</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article id="post-quick-start-on-antlr4-in-rust-part1" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-05-29T00:00:00.000Z"><a href="/2020/05/29/quick-start-on-antlr4-in-rust-part1/">2020-05-29</a></time>
      
      
  
    <h1 class="title"><a href="/2020/05/29/quick-start-on-antlr4-in-rust-part1/">Quick start on ANTLR4 in Rust - part1</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><em>This is my note in adopting and learning ANTLR4Rust</em></p>
<p><strong>Series</strong></p>
<ul>
<li>Quick Start on ANTLR4 in Rust — Part1 (This article)</li>
<li><a href="/2020/06/02/quick-start-on-antlr4-in-rust-part2">Quick Start on ANTLR4 in Rust — Part2</a></li>
<li><a href="/2020/06/10/quick-start-on-antlr4-in-rust-part3">Quick Start on ANTLR4 in Rust — Part3</a></li>
</ul>
<hr>
<p>Install nightly version of Rust (and make it default if you want for convenience).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rustup toolchain install nightly</span><br><span class="line">$ rustup default nightly</span><br></pre></td></tr></table></figure>

<p>Get ANTLR4 runtime for Rust from <a target="_blank" rel="noopener" href="https://github.com/rrevenantt/antlr4rust/releases">here</a>:</p>
<p>Prepare a grammar. I will use an example grammar: <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/antlr/grammars-v4/master/csv/CSV.g4">https://raw.githubusercontent.com/antlr/grammars-v4/master/csv/CSV.g4</a></p>
<p>Generate a parser:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar &lt;ANTLR4 runtime path&gt; -Dlanguage=Rust CSV.g4</span><br></pre></td></tr></table></figure>

<p>You will get <code>csvlexer.rs</code>, <code>csvlistener.rs</code> , <code>csvparser.rs</code> . Place them into your project <code>src</code> directory.</p>
<p>Add dependencies in <code>Cargo.toml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dependencies]</span><br><span class="line">lazy_static = &quot;1.4&quot;</span><br><span class="line">antlr-rust = &quot;0.1&quot;</span><br></pre></td></tr></table></figure>

<p>Add a feature and import <code>lazy_static</code> macros to the root module:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(try_blocks)]</span></span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> crates lazy_static;</span><br></pre></td></tr></table></figure>

<p>Import common and essential things:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> antlr_rust::common_token_stream::CommonTokenStream;</span><br><span class="line"><span class="keyword">use</span> antlr_rust::input_stream::InputStream;</span><br><span class="line"><span class="keyword">use</span> antlr_rust::parser_rule_context::ParserRuleContext;</span><br><span class="line"><span class="keyword">use</span> antlr_rust::tree::&#123;ErrorNode, ParseTreeListener, TerminalNode&#125;;</span><br></pre></td></tr></table></figure>

<p>Import grammar-specific things:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> csvlexer;</span><br><span class="line"><span class="keyword">mod</span> csvlistener;</span><br><span class="line"><span class="keyword">mod</span> csvparser;</span><br><span class="line"><span class="keyword">use</span> csvlexer::CSVLexer;</span><br><span class="line"><span class="keyword">use</span> csvlistener::CSVListener;</span><br><span class="line"><span class="keyword">use</span> csvparser::*;</span><br></pre></td></tr></table></figure>

<p>Implement <code>ParseTreeListener</code>, a supertraint of <code>CSVListener</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Listener</span>;<span class="keyword">impl</span> <span class="title class_">ParseTreeListener</span> <span class="keyword">for</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_terminal</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, node: &amp;TerminalNode) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_error_node</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, node: &amp;ErrorNode) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_every_rule</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ctx: &amp;<span class="keyword">dyn</span> ParserRuleContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_every_rule</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ctx: &amp;<span class="keyword">dyn</span> ParserRuleContext) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Implement <code>CSVListener</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">CSVListener</span> <span class="keyword">for</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;CsvFileContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;CsvFileContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_hdr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;HdrContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_hdr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;HdrContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_row</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;RowContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_row</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;RowContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_field</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;FieldContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_field</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;FieldContext) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Read and parse an input. Note that <code>csvFile</code> in the last line is a rule name in <code>CSV.g4</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line"><span class="string">&quot;This, is, a, header</span></span><br><span class="line"><span class="string">This, is, a, row</span></span><br><span class="line"><span class="string">&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lexer</span> = CSVLexer::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(InputStream::<span class="title function_ invoke__">new</span>(input)));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">token_source</span> = CommonTokenStream::<span class="title function_ invoke__">new</span>(lexer);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">parser</span> = CSVParser::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(token_source));</span><br><span class="line">    parser.<span class="title function_ invoke__">add_parse_listener</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Listener &#123;&#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = parser.<span class="title function_ invoke__">csvFile</span>();</span><br><span class="line">    <span class="built_in">assert!</span>(result.<span class="title function_ invoke__">is_ok</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The minimal working example can be found <a target="_blank" rel="noopener" href="https://github.com/internalstability/antlr4rust_quickstart/commit/1a4fb82e23bf9c5a33ed2298ef875f1fee80151f">here</a>.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-trilateration-using-the-levenberg-marquardt-method" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-05-29T00:00:00.000Z"><a href="/2020/05/29/trilateration-using-the-levenberg-marquardt-method/">2020-05-29</a></time>
      
      
  
    <h1 class="title"><a href="/2020/05/29/trilateration-using-the-levenberg-marquardt-method/">Trilateration using the Levenberg-Marquardt method</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <blockquote>
<p>True range multilateration is a method to determine the location of a movable vehicle or stationary point in space using multiple ranges (distances) between the vehicle&#x2F;point and multiple spatially-separated known locations (often termed ‘stations’). — True range multilateration, Wikipedia</p>
</blockquote>
<p>We can define a trilateration as an optimization problem to minimize a cost function \(S\) for a given estimate \(\beta\)<em>,</em> a tuple of \((x, y, z)\)</p>
<p>$$\begin{aligned}<br>S(\beta)&amp;&#x3D;\sum_{i&#x3D;1}^{N}f_i(\beta)\\<br>&amp;&#x3D;\sum_{i&#x3D;1}^{N}\left[r_i-\sqrt{(x-X_i)^2+(y-Y_i)^2+(z-Z_i)^2}\right]^2<br>\end{aligned}$$</p>
<p>where \(r_i\) is a measured distnace between an Anchor (i), whose coordinates are \((X_i, Y_i, Z_i)\).</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Levenberg-Marquardt_algorithm">Levenberg-Marquardt method</a> is defined by:</p>
<p>$$\beta_{k+1}&#x3D;\beta_k-\left(J^TJ+\mu_kdiag\left(J^TJ\right)\right)^{-1}J^Tf(\beta_k)$$</p>
<p>where \(J\) is the Jacobian matrix and \(f\) is a column vector composed of \(f_i\):</p>
<p>$$\begin{aligned}<br>J&amp;&#x3D;\begin{bmatrix}<br>\frac{\partial f_1}{\partial x} &amp; \frac{\partial f_1}{\partial y} &amp; \frac{\partial f_1}{\partial z} \\<br>\frac{\partial f_2}{\partial x} &amp; \frac{\partial f_2}{\partial y} &amp; \frac{\partial f_2}{\partial z} \\<br>\vdots &amp; \vdots &amp; \vdots \\<br>\frac{\partial f_N}{\partial x} &amp; \frac{\partial f_N}{\partial y} &amp; \frac{\partial f_N}{\partial z}<br>\end{bmatrix}\\<br>&amp;&#x3D;\begin{bmatrix}<br>F_1(x-X_1) &amp; F_1(y-Y_1) &amp; F_1(z-Z_1) \\<br>F_2(x-X_2) &amp; F_2(y-Y_2) &amp; F_2(z-Z_2) \\<br>\vdots &amp; \vdots &amp; \vdots \\<br>F_N(x-X_N) &amp; F_N(y-Y_N) &amp; F_N(z-Z_N)<br>\end{bmatrix}<br>\end{aligned}$$</p>
<p>where \(F_i\) is a shorthand of each derivative:</p>
<p>$$F_i&#x3D;\frac{r_i}{\sqrt{(x-X_i)^2+(y-Y_i)^2+(z-Z_i)^2}}$$</p>
<p>Now, we can estimate \(\beta\) by iterating the equation until it converges.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-git-hooks-with-stderr" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-05-28T00:00:00.000Z"><a href="/2020/05/28/git-hooks-with-stderr/">2020-05-28</a></time>
      
      
  
    <h1 class="title"><a href="/2020/05/28/git-hooks-with-stderr/">Git Hooks with stderr</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>For example, it’s tricky to validate a commit with pre-commit hook if an app does not return a proper exit code. Here’s a way to validate with the stderr.</p>
<ol>
<li>Make a temporary file</li>
<li>Redirect stderr to the temp file</li>
<li>Count the length of its content</li>
</ol>
<p>You can understand it with code snippets below:</p>
<p><strong>PowerShell</strong></p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$errFile</span> = <span class="built_in">New-TemporaryFile</span></span><br><span class="line">command &gt; /dev/null <span class="number">2</span>&gt;<span class="variable">$errFile</span></span><br><span class="line"><span class="variable">$err</span> = <span class="built_in">Get-Content</span> <span class="variable">$errFile</span></span><br><span class="line"><span class="keyword">If</span> (<span class="variable">$err</span>.Length <span class="operator">-ne</span> <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">Exit</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">Exit</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><strong>Unix&#x2F;Linux shell</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">errFile = $(<span class="built_in">mktemp</span>)</span><br><span class="line"><span class="built_in">command</span> &gt; /dev/null 2&gt;<span class="variable">$errFile</span></span><br><span class="line"><span class="variable">$l</span> = <span class="built_in">wc</span> -l <span class="variable">$errFile</span></span><br><span class="line"><span class="keyword">if</span> [<span class="variable">$l</span> -ne 0]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-preventing-privacy-leak-with-turingfonts-substitution-cipher" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-03-07T00:00:00.000Z"><a href="/2020/03/07/preventing-privacy-leak-with-turingfonts-substitution-cipher/">2020-03-07</a></time>
      
      
  
    <h1 class="title"><a href="/2020/03/07/preventing-privacy-leak-with-turingfonts-substitution-cipher/">Preventing privacy leak with TuringFonts (substitution cipher)</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>Download one of web fonts (<code>.woff2</code>) from <a target="_blank" rel="noopener" href="http://jfmdev.github.io/TuringFonts/">TuringFonts</a>. Assumed Zebra is used here</p>
<p>Put the font to the web directory and define the below in a stylesheet:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: ArialZebra;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;arial_zebra.woff2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.zebra-substitution</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: ArialZebra</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assign <code>zebra-substitution</code> class to where it needs</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;zebra-substitution&quot;</span>&gt;</span>pgalk87@cjzfi.blj<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codepen.io/gsongsong/pen/MWwdMZO">See</a> how it looks.</p>
<p>TuringFonts also provides <a target="_blank" rel="noopener" href="http://jfmdev.github.io/TuringFonts/encoder.html">Encoder</a> to get a ciphered text.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-quick-start-on-sending-email-with-amazon-ses-on-node-js" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2019-07-07T00:00:00.000Z"><a href="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/">2019-07-07</a></time>
      
      
  
    <h1 class="title"><a href="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/">Quick start on sending email with Amazon SES on Node.js</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>Although Amazon provides great documentation, this is what all I needed to send an email with Amazon SES (Simple Email Service) on Node.js.</p>
<h2><span id="get-started-with-amazon-ses">Get Started with Amazon SES</span></h2><img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/intro.png" class>

<p>To start, visit <a target="_blank" rel="noopener" href="https://aws.amazon.com/ses">Amazon SES</a> and hit <em>Get started with Amazon SES</em>. Then Amazon asks which region you want to use SES. Note that <strong>region for SES doesn’t need to be the same with your other Amazon services</strong>.</p>
<h2><span id="verify-your-domain-or-email-address">Verify Your Domain or Email Address</span></h2><img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/dashboard.png" class>

<p>After choosing the region, you will see the page above. I highlighted menus you need. You can use two types of identities, domains and email addresses. If you have your own domain and you want to send an email from the domain, the first one needs to be configured. If you want to send an email from your existing email account such as Gmail and Outlook, the second one needs to be configured. <strong>The first one and the second one is not mutually exclusive. You can use both.</strong></p>
<h3><span id="option-1-verify-your-domain">Option 1: Verify Your Domain</span></h3><img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/verify-domain-01.png" class>

<p>After entering <em>Domains</em> menu, hit <em>Verify a New Domain</em>.</p>
<img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/verify-domain-02.png" class>

<p>In the popup, type your domain in interest, check <em>Generate DKIM Settings</em> and hit <em>Verify This Domain.</em></p>
<img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/verify-domain-03.png" class>

<p>For a given domain, SES requests you to configure DNS records in order to verify whether the domain is owned by you. SES will try to verify the domain constantly. If verification succeeds, you will see <em>Verification: verified, DKIM Status: verified, Enalbed for: Yes</em> in the dashboard as shows in the above. Then it’s all set.</p>
<h3><span id="option-2-verify-your-email-address">Option 2: Verify Your Email Address</span></h3><p>Verifying an email address is simpler. After entereing <em>Email Addresses</em> menu, hit <em>Verify a New Email Address</em> and type an email address in interest. And then SES will send a verification email to a given email address. Once you visit a link given in the verification email, the email address will be verified. Then it’s all set.</p>
<h2><span id="build-nodejs-application-sending-email-with-ses">Build Node.js Application Sending Email with SES</span></h2><h3><span id="install-aws-sdk">Install AWS SDK</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install aws-sdk</span><br></pre></td></tr></table></figure>

<h3><span id="configure-aws-credentials">Configure AWS Credentials</span></h3><p>To verify whether your Node.js application has the right permissions to send an email with SES, you need to provide the right credentials to AWS SDK.</p>
<img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/credential-01.png" class>

<p>Visit <a target="_blank" rel="noopener" href="https://console.aws.amazon.com/iam/home#/security_credentials">IAM Management Console</a> and hit <em>Create New Access Key</em>.</p>
<img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/credential-02.png" class>

<p>Don’t worry. The keys have been deleted</p>
<p>Remember the created access key and write it down to the following file:</p>
<ul>
<li>Windows: <code>C:\Users\*USERNAME*\.aws\credentials</code></li>
<li>Linux, Unix, or macOS: <code>~/.aws/credentials</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[default]</span><br><span class="line">aws_access_key_id = AKIAJ4LGGMQNZ4IJK5XA</span><br><span class="line">aws_secret_access_key = 00pkJqVkmR70kLpXRoqRaoB6zcpo1OmnVeuKvlyP</span><br></pre></td></tr></table></figure>

<p>Now AWS SDK will read access key from the credential file and prove your application has the right permissions.</p>
<p>Also you can <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/loading-node-credentials-json-file.html">store AWS credentials in JSON file and load it from Node.js</a>.</p>
<p><strong>Note: Access key allows full access to your Amazon AWS. Do not disclose access key publicly. I recommend to <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html">create an IAM user and allows only SES</a></strong></p>
<h3><span id="script-sending-email-with-ses">Script Sending Email with SES</span></h3><p>The simplest Node.js script sending an email with SES is provided in Amazon Documentation or its GitHub repository, so I’ll skip the entire script here:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/ses-examples-sending-email.html">https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/ses-examples-sending-email.html</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/javascript/example_code/ses/ses_sendemail.js">https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/javascript/example_code&#x2F;ses&#x2F;ses_sendemail.js</a></li>
</ul>
<h2><span id="requst-a-sending-limit-increase">Requst a Sending Limit Increase</span></h2><p>Initially, your SES operates in <em>sandbox</em> mode andcan send an email only to domains or email addresses which you verified in the above. To be able to send an email to anyone, you need to <em>Request a Sending Limit Increase</em>.</p>
<img src="/2019/07/07/quick-start-on-sending-email-with-amazon-ses-on-node-js/limit.png" class>

<p>Visit <a target="_blank" rel="noopener" href="https://console.aws.amazon.com/support/cases#/create?issueType=service-limit-increase&limitType=service-code-ses">Create Case</a> and create a case to request a sending limit increase.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-positioning-system-using-decawave-dw1000" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-08-24T00:00:00.000Z"><a href="/2017/08/24/positioning-system-using-decawave-dw1000/">2017-08-24</a></time>
      
      
  
    <h1 class="title"><a href="/2017/08/24/positioning-system-using-decawave-dw1000/">Positioning system using DecaWave DW1000</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2><span id="decawaves-dw1000">DecaWave’s DW1000</span></h2><p><a target="_blank" rel="noopener" href="https://decawave.com/products/dw1000">DW1000</a> is a UWB communication and ranging module manufactured by DecaWave.<br>It provides a fairly good ranging accuracy (&lt; 2 cm).  Not only a simple anchor-tag ranging system, let’s make a practical centimeter-level precision indoor positioning system using it</p>
<h2><span id="system-design">System Design</span></h2><h3><span id="overview">Overview</span></h3><p>A setup is shown in a figure below:</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/overview.png" class>

<ul>
<li>A tag<ul>
<li>A tag is composed of two components—Raspberry Pi and Arduino Pro Mini</li>
<li>Raspberry Pi controles a higher level indoor positioning system<ul>
<li>It triggers Arduino Pro Mini to probe anchors and measure distance between it and each anchor</li>
<li>It requests distance measurements on Arduino Pro Mini and locate itself through trilateration</li>
</ul>
</li>
<li>Arduino Pro Mini<ul>
<li>It is required due to similar reasons of anchors</li>
<li>It receives commands from Raspberry Pi and executes the corresponding process<br>  Processes are:<ul>
<li>Probing anchors nearby and exchanging series of frames with each anchor<br>  to measure distance</li>
<li>Reporting probed anchors and measured distance values</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Anchors<ul>
<li>They are deployed in a site of interest and their 2D&#x2F;3D coordinates are known</li>
<li>They are implemented on Arduino Pro Mini for the following reasons:<ul>
<li>Arduino Pro Mini’s low power consumption</li>
<li>Anchor’s fast response requirement (order of milliseconds)</li>
<li>Anchor’s simple tasks (receiving and transmitting UWB frames)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>An overall sequence diagram is illustrated below. <code>Tag (Arduino)</code> is actually composed of Arduino Pro Mini and DW1000.</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/sequence.png" class>

<h3><span id="state-machine-tag">State Machine: Tag</span></h3><p>A figure below is a state diagram of a tag:</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/state-tag.png" class>

<p>When a Raspberry Pi commands via I2C to scan, it goes into <code>SCAN</code> state and broadcasts a <code>PING</code> message. Going into <code>PONG</code> state immediately, it waits for <code>PONG</code> messages from anchors nearby for a certain duration. I set it to 100 ms.</p>
<p>If it discovers 3 or more anchors during the <code>PONG</code> state, it goes into <code>ROUNDROBIN</code> state. It exchanges 4 messages with each discovered anchor sequentially, i.e. <code>POLL</code> to an anchor, <code>POLL_ACK</code> from an anchor, <code>RANGE</code> to an anchor, and <code>RANGE_REPORT</code> from an anchor. After sending <code>POLL</code> and <code>RANGE</code> message, it waits for a response message for a certain timeout of 10 ms.</p>
<p>After 4 messages are exchanged with each anchor, it calculates distance between an anchor using Tx&#x2F;Rx timestamp. It adopts two-way ranging algorithm, which is a bit computational intensive, but I think it is not that much intensive. For more information about two-way ranging, please refer the official appliclation note <a target="_blank" rel="noopener" href="https://decawave.com/sites/default/files/aps013_dw1000_and_two_way_ranging_v2.2.pdf">APS013 by DecaWave</a>.</p>
<h3><span id="state-machine-anchor">State Machine: Anchor</span></h3><p>A state diagram of an anchor is simple:</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/state-tag.png" class>

<ul>
<li>It normally stays at <code>IDLE</code> state</li>
<li>If it receives a <code>PING</code> message, it tries to send a <code>PONG</code> message with a random delay between 0 and 90 ms to avoid the collision and goes into <code>PENDING_PONG</code> state</li>
<li>If it receives a <code>POLL</code> message and sends a <code>POLL_ACK</code> message, it goes into <code>RANGE</code> state and waits for a <code>RANGE</code> message is received<ul>
<li>If timeout of 10 ms expires, it returns to <code>IDLE</code> state</li>
<li>If it receives a <code>RANGE</code> message, it sends a <code>RANGE_REPORT</code> message to a tag</li>
</ul>
</li>
</ul>
<h2><span id="implementation">Implementation</span></h2><p>The whole implementation can be found in <a target="_blank" rel="noopener" href="https://github.com/internalstability/dw1000-positioning">my GitHub repository</a>. I used <a target="_blank" rel="noopener" href="https://github.com/thotro/arduino-dw1000">arduino-dw1000</a> for controlling DW1000 using Arduino. I followed wiring between Arduino Pro Mini and DW1000 as defined in <code>examples/Ranging&#123;Anchor,Tag&#125;</code> of the library. Only I2C interface is needed to connect Raspberry Pi and Arduino Pro Mini</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-building-thrift-on-windows-10" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-07-18T00:00:00.000Z"><a href="/2017/07/18/building-thrift-on-windows-10/">2017-07-18</a></time>
      
      
  
    <h1 class="title"><a href="/2017/07/18/building-thrift-on-windows-10/">Building Thrift on Windows 10</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>Contrast to Linux and macOSs, many are having difficult times building and using Thrift on Windows 10. Most Thrift guides on the internet miss some parts. Here’s the correct way to build and use Thrift on Windows 10.</p>
<h2><span id="dependencies">Dependencies</span></h2><ul>
<li>Boost</li>
<li>OpenSSL (for secure socket)</li>
<li>libevent (for callback)</li>
</ul>
<h3><span id="boost">Boost</span></h3><ul>
<li>Download <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/boost/files/boost-binaries/">boost</a>. At this time of writing, the latest version is 1.64.0. I downloaded <code>boost_1_64_0-msvc-14.1-64.exe</code>.<ul>
<li>You must download a correct binary with consideration of OS addressing mode (32&#x2F;64 bits) and MSVC version</li>
<li>You can check MSVC version in a project property page of a  project which will use Thrift</li>
</ul>
</li>
</ul>
<img src="/2017/07/18/building-thrift-on-windows-10/msvc-version.png" class>

<ul>
<li><p>Execute the downloaded file to extract files. In my case, <code>C:\boost_1_64_0</code></p>
</li>
<li><p>Open <code>**Native Tools Command Prompt**</code> and execute the following commands</p>
  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\boost_1_64_0</span><br><span class="line">bootstrap</span><br><span class="line">b2 <span class="literal">--build-type</span>=minimal <span class="literal">--stagedir</span>=stage/x64 ^</span><br><span class="line">   threading=multi link=<span class="keyword">static</span> toolset=msvc<span class="literal">-14</span>.<span class="number">0</span> ^</span><br><span class="line">   variant=release address<span class="literal">-model</span>=<span class="number">64</span> architecture=x86 ^</span><br><span class="line">   <span class="literal">-j8</span></span><br></pre></td></tr></table></figure>

<p>  Options are:</p>
<ul>
<li><code>stagedir</code>: directory to store built files</li>
<li><code>threading=multi</code>: build thread-safe Boost</li>
<li><code>link=static</code>: build static Boost library</li>
<li><code>toolset=msvc-14.0</code>: Visual Studio MSVC (Platform Toolset) used for a project</li>
<li><code>variant=release</code>: Debug&#x2F;Release configuration used for a project</li>
<li><code>address-model=64</code>: addressing mode of your OS</li>
<li><code>architecture=x86</code>: your CPU architecture</li>
</ul>
</li>
</ul>
<h3><span id="openssl">OpenSSL</span></h3><ul>
<li>Download <a target="_blank" rel="noopener" href="https://slproweb.com/products/Win32OpenSSL.html">OpenSSL v1.0.2L binary</a> (not light version)<ul>
<li>v1.1.0 causes an <code>SSLv3_method</code>-related error when building Thrift, at least in my case</li>
<li>Be careful of the addressing mode of your OS</li>
</ul>
</li>
<li>Install OpenSSL by executing the downloaded file. I installed it under <code>C:\OpenSSL-Win64</code></li>
</ul>
<h3><span id="libevent">libevent</span></h3><ul>
<li>Download <a target="_blank" rel="noopener" href="http://libevent.org/">libevent-2.0.22</a> (v2.1.8 has an issue)</li>
<li>Extract it under <code>C\:libevent-2.0.22-stable</code>, or whereever you want</li>
<li>Open <code>**Native Tools Command Prompt**</code> and build it by executing <code>nmake -f Makefile.nmake</code></li>
</ul>
<h2><span id="building-thrift">Building Thrift</span></h2><ul>
<li>Download <a target="_blank" rel="noopener" href="https://github.com/apache/thrift/releases/tag/0.9.2">Thrift 0.9.2</a> (v0.9.3 and later version have an issue) and extract it to somewhere (<code>C:\thrift-0.9.2</code>, in my case)</li>
<li>Open a solution <code>thrift.sln</code> under <code>C:\thrift-0.9.2\lib\cpp</code>. There are two projects: <code>libthrift</code> and <code>libthriftnb</code></li>
<li>Open property pages and adjust <code>Target Platform Version</code> and <code>Platform Toolset</code> as the same as a project which you are working on</li>
<li>Set parameters as the following:<ul>
<li><p><code>libthrift</code></p>
<ul>
<li>C&#x2F;C++ &gt; General &gt; Additional Include Directories<ul>
<li><code>C:\OpenSSL-Win64\include</code>, <code>C:\boost_1_64_0</code></li>
</ul>
</li>
<li>Librarian &gt; All Options<ul>
<li>Additional Dependencies<ul>
<li><code>libeay32.lib</code>, <code>ssleay32.lib</code>, <code>libeay32MT.lib</code>, <code>ssleay32MT.lib</code></li>
</ul>
</li>
<li>Additional Library Directories<ul>
<li><code>C:\OpenSSL-Win64\lib</code>, <code>C:\OpenSSL-Win64\lib\VC\static</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>  Note that you need to add other library files and directories according to static&#x2F;dynamic link and Debug&#x2F;Release configuration</p>
</li>
<li><p><code>libthriftnb</code></p>
<ul>
<li>C&#x2F;C++ &gt; General &gt; Additional Include Directories<ul>
<li><code>C:\libevent-2.0.22-stable\include</code>, <code>C:\libevent-2.0.22-stable\WIN32-Code</code>, <code>C:\libevent-2.0.22-stable</code>, <code>C:\boost_1_64_0</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Build <code>libthrift</code> and <code>libthriftn</code> sequentially</li>
</ul>
<h2><span id="testing-thrift">Testing Thrift</span></h2><ul>
<li><p>Grab the <a target="_blank" rel="noopener" href="https://thrift.apache.org/tutorial/cpp">example code</a> and make a project for each server and client</p>
</li>
<li><p>Get the <a target="_blank" rel="noopener" href="https://archive.apache.org/dist/thrift/0.9.2/">Thrift compiler</a> and compile Thrift definition files above</p>
</li>
<li><p>Set parameters of each project as the following:</p>
<ul>
<li>C&#x2F;C++ &gt; General &gt; Additional Include Directories<ul>
<li><code>C:\boost_1_64_0</code>, <code>C:\thrift-0.9.2\lib\cpp\src\thrift\windows</code>, <code>C:\thrift-0.9.2\lib\cpp\src</code></li>
</ul>
</li>
<li>Linker &gt; All Options<ul>
<li>Additional Dependencies<ul>
<li>libthrift.lib</li>
</ul>
</li>
<li>Additional Library Directories<ul>
<li><p><code>C\:thrift-0.9.2\lib\cpp\x64\Release</code>, <code>C:\boost_1_64_0\stage\x64\lib</code></p>
<p>  Note: you may need to add other directories according to Debug&#x2F;Release configuration</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Build and start a server project and then a client project. You can see Thrift working</p>
</li>
</ul>
<img src="/2017/07/18/building-thrift-on-windows-10/demo.png" class>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-reading-ranging-data-from-decawave-evk1000" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-05-14T00:00:00.000Z"><a href="/2017/05/14/reading-ranging-data-from-decawave-evk1000/">2017-05-14</a></time>
      
      
  
    <h1 class="title"><a href="/2017/05/14/reading-ranging-data-from-decawave-evk1000/">Reading ranging data from DecaWave EVK1000</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2><span id="decawave-evk1000-and-trek1000">DecaWave EVK1000 and TREK1000</span></h2><p>EVK1000 and TREK1000 are Two-way Ranging Evaluation Kit for DecaWave’s UWB DW1000 chip. You can see and evaluate a ranging result on a screen of each of them. However, to see a positioning result, you need to connect one of them with a PC and use DecaWave’s dedicated software only on Windows. Here’s how to read data from EVK1000 without the dedicated software</p>
<h2><span id="preparing-a-driver">Preparing a Driver</span></h2><p>This kit has a COM (serial) port. But this port is wrapped with USB interface and operates with a virtual COM port driver</p>
<ul>
<li>On Windows, a driver for this (STM32 Virtual ComPort in FS Mode v1.4.0) can be downloaded at here. After downloading and extracting the file, run <code>&lt;OS&gt;/dpinst_&lt;arch&gt;</code>.exe where <code>&lt;OS&gt;</code> and <code>&lt;arch&gt;</code> are your OS and architecture, respectively. A related thread can be found <a target="_blank" rel="noopener" href="http://forum.espruino.com/conversations/290299/">here</a></li>
<li>On Linux and macOS, when a board is connected, a driver will be automatically loaded</li>
</ul>
<p>For more detail, please refer <a target="_blank" rel="noopener" href="http://www.ftdichip.com/Drivers/VCP.htm">FTDI Chip</a></p>
<h2><span id="reading-and-parsing-ranging-data">Reading and Parsing Ranging Data</span></h2><p>Configure anchors and a tag by flipping switches as instruction says, and connect an anchor or a tag with a PC. Since it uses a virtual COM port, serial communication parameters are automatically configured and you don’t need to worry about it</p>
<p>When connection is successful, you can see outputs on a serial port terminal as the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mr 01 000004d1 00000000 00000000 00000000 001e 20 403c403c t7:0</span><br><span class="line">mc 01 0000058c 00000000 00000000 00000000 001f 21 00003fe5 t7:0</span><br><span class="line">mr 01 000004ba 00000000 00000000 00000000 001f 21 403c403c t7:0</span><br><span class="line">mc 01 0000059a 00000000 00000000 00000000 0020 22 000040fd t7:0</span><br><span class="line">mr 01 000004c8 00000000 00000000 00000000 0020 22 403c403c t7:0</span><br><span class="line">mc 01 00000579 00000000 00000000 00000000 0021 23 00004215 t7:0</span><br><span class="line">mr 01 000004a7 00000000 00000000 00000000 0021 23 403c403c t7:0</span><br><span class="line">mc 01 0000059a 00000000 00000000 00000000 0022 24 0000432d t7:0</span><br><span class="line">mr 01 000004c8 00000000 00000000 00000000 0022 24 403c403c t7:0</span><br><span class="line">mc 01 00000574 00000000 00000000 00000000 0023 25 00004445 t7:0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Here, important columns are from the 3rd to 6th, 7th, 8th columns</p>
<ul>
<li>The 3rd to 6th columns represent a range measurement from each anchor 0 to 3 in hexadecimal<ul>
<li>For example, <code>000004d1</code> represents <code>0x4d1</code> or <code>1233</code>, which is 1.233 m.</li>
</ul>
</li>
<li>The 7th column represents a sequence number</li>
<li>The 8th column represents a ranging sequence number</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-modifying-regulations-in-intel-wi-fi-card-eeprom" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-04-22T00:00:00.000Z"><a href="/2017/04/22/modifying-regulations-in-intel-wi-fi-card-eeprom/">2017-04-22</a></time>
      
      
  
    <h1 class="title"><a href="/2017/04/22/modifying-regulations-in-intel-wi-fi-card-eeprom/">Modifying regulations in Intel Wi-Fi card EEPROM</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2><span id="regulations-in-eeprom">Regulations in EEPROM</span></h2><p>Wi-Fi regulation defines various restirctions such as transmission power, initial radiation, and dynamic frequency switching for Wi-Fi to operate in a certain country. Most OSs including Linux contain regulations in their kernels, and we can bypass them by modifying a regulation file or a kernel.</p>
<p>However, certain Wi-Fi cards such as Intel’s have their own regulations in their EEPROM, which takes precedence to kernel’s regulations. Here’s how to modify regulations in <a target="_blank" rel="noopener" href="https://wikidevi.com/wiki/Intel_WiFi_Link_5300_(full_size)">Intel Wi-Fi card’s EEPROM</a>. In this article, Intel Ultimate N WiFi Link 5300 is used</p>
<h2><span id="preparing-a-tool">Preparing a Tool</span></h2><p><a target="_blank" rel="noopener" href="https://github.com/0x90/iwleeprom">iwleeprom</a> is a software to read and write content in an EEPROM. Clone, build and install it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/0x90/iwleeprom](https://github.com/0x90/iwleeprom)</span><br><span class="line">$ <span class="built_in">cd</span> iwleeprom</span><br><span class="line">$ make</span><br><span class="line">$ [sudo] make install</span><br></pre></td></tr></table></figure>

<h2><span id="interpreting-a-regulation-flag">Interpreting a Regulation Flag</span></h2><p>First, let’s have a look at what EEPROM contains. To read regulations in EEPROM, type iwleeprom -s:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ iwleeprom -s</span><br><span class="line">Supported devices detected:</span><br><span class="line">[1] 0000:03:00.0 [RW] Ultimate N WiFi Link 5300 (8086:4236, 8086:1011)</span><br><span class="line">Select device [1-1] (or 0 to quit): 1</span><br><span class="line">Using device 0000:03:00.0 [RW] Ultimate N WiFi Link 5300</span><br><span class="line">No file names given or patch option selected!</span><br><span class="line">No EEPROM actions will be performed, just write-enable <span class="built_in">test</span></span><br><span class="line">Regulatory data from card EEPROM...</span><br><span class="line">Regulatory base: 0156</span><br><span class="line">Channel 1: 0e6f</span><br><span class="line">Channel 2: 0f6f</span><br><span class="line">...</span><br><span class="line">Channel 64: 0f31</span><br><span class="line">...</span><br><span class="line">Channel 1 (HT40): 0a6f</span><br><span class="line">Channel 2 (HT40): 0f6f</span><br><span class="line">...</span><br><span class="line">Channel 157 (HT40): 0f61</span><br></pre></td></tr></table></figure>

<p>What those <code>0e6f</code>, <code>0f31</code> and other things mean? Those are <em>flags</em> defining regulations. So, which bit stands for what? When you are looking into Linux kernel source code, specifically, <a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/4bdd4dfe7a893594a75ca324057f7010b1762bd2/drivers/net/wireless/intel/iwlwifi/iwl-eeprom-parse.c#L289-L305"><code>iwlwifi</code> driver</a>, you can see flag definition as below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * enum iwl_eeprom_channel_flags - channel flags in EEPROM</span></span><br><span class="line"><span class="comment"> * @EEPROM_CHANNEL_VALID: channel is usable for this SKU/geo</span></span><br><span class="line"><span class="comment"> * @EEPROM_CHANNEL_IBSS: usable as an IBSS channel</span></span><br><span class="line"><span class="comment"> * @EEPROM_CHANNEL_ACTIVE: active scanning allowed</span></span><br><span class="line"><span class="comment"> * @EEPROM_CHANNEL_RADAR: radar detection required</span></span><br><span class="line"><span class="comment"> * @EEPROM_CHANNEL_WIDE: 20 MHz channel okay (?)</span></span><br><span class="line"><span class="comment"> * @EEPROM_CHANNEL_DFS: dynamic freq selection candidate</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">iwl_eeprom_channel_flags</span> &#123;</span></span><br><span class="line">EEPROM_CHANNEL_VALID = BIT(<span class="number">0</span>),</span><br><span class="line">EEPROM_CHANNEL_IBSS = BIT(<span class="number">1</span>),</span><br><span class="line">EEPROM_CHANNEL_ACTIVE = BIT(<span class="number">3</span>),</span><br><span class="line">EEPROM_CHANNEL_RADAR = BIT(<span class="number">4</span>),</span><br><span class="line">EEPROM_CHANNEL_WIDE = BIT(<span class="number">5</span>),</span><br><span class="line">EEPROM_CHANNEL_DFS = BIT(<span class="number">7</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>For example, channel 1 has flags <code>0e6f</code>, which is <code>1110 0110 1111</code> in binary. Its interpretation is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1110 0110 1111</span><br><span class="line">.............1 This channel is valid</span><br><span class="line">............1. Not valid for IBSS</span><br><span class="line">...........1.. (Unknown)</span><br><span class="line">..........1... Active scanning is allowed</span><br><span class="line">........0..... RADAR detection is not required</span><br><span class="line">.......1...... Supports wide band</span><br><span class="line">......1....... Candidate for dynamic frequency selection</span><br></pre></td></tr></table></figure>

<h2><span id="reading-eeprom">Reading EEPROM</span></h2><p>To read and dump EEPROM, type <code>iwleeprom -o &lt;outfile&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ iwleeprom -b -o eeprom_dump</span><br><span class="line">Supported devices detected:</span><br><span class="line">[1] 0000:03:00.0 [RW] Ultimate N WiFi Link 5300 (8086:4236, 8086:1011)</span><br><span class="line">Select device [1-1] (or 0 to quit): 1</span><br><span class="line">Using device 0000:03:00.0 [RW] Ultimate N WiFi Link 5300</span><br><span class="line">Saving dump with byte order: BIG ENDIAN</span><br><span class="line">0000 [................................................................]</span><br><span class="line">0080 [................................................................]</span><br><span class="line">...</span><br><span class="line">0780 [................................................................]</span><br><span class="line"></span><br><span class="line">EEPROM has been dumped to eeprom_dump</span><br></pre></td></tr></table></figure>

<p>We can view the dumped EEPROM with <code>xxd</code> command or hex mode (<code>:%!xxd</code>) in <code>vim</code>, and can find channel flags. They are written in the same order of channels, but their offsets are not in linear relationships. You can manually locate an offset of each channel:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ vim eeprom_dump</span><br><span class="line">:%!xxd</span><br><span class="line">00000000: 5a40 0050 7000 0410 0030 0000 0280 8086 4236 8086 1011 0d01 Z@.Pp....0......B6.......</span><br><span class="line">...</span><br><span class="line">00000150: ---- ---- ---- ---- ---- ---- ---- --0e 6f0f 6f0f 6f0f 6f0f :.........oM.W...o.o.o.o.</span><br><span class="line">00000168: 6f0f 6f0f 6f0f 6f0f 6f0f 6f0f 6f0f 610f 6100 0000 0000 0000 :o.o.o.o.o.o.o.a.a.......</span><br><span class="line">00000180: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 :........................</span><br><span class="line">00000198: 0000 000f e100 000f e100 000f e100 000f e10f 310f 310f 310f :..................1.1.1.</span><br><span class="line">000001b0: 3100 000f 310f 310f 310f 310f 310f 310f 310f 310f 310f 310f :1...1.1.1.1.1.1.1.1.1.1.</span><br><span class="line">000001c8: 3100 0000 000f a10f a10f a10f a10f a100 000d 0a6f 0f6f 0f6f :1..................o.o.o</span><br><span class="line">000001e0: 0f6f 0f6f 0f6f 0c6f 0000 0ce1 0fe1 0f31 0d31 0e31 0f31 0f31 :.o.o.o.o.......1.1.1.1.1</span><br><span class="line">000001f8: 0f31 0f31 0f61 0f61 :.1.1.a.a</span><br></pre></td></tr></table></figure>

<h2><span id="modifying-regulations">Modifying Regulations</span></h2><p>It is easy. Open the dumped EEPROM in <code>vim</code> and set to hex mode (<code>:%!xxd</code>). And change the content as you want. To save changes, reert hex mode (<code>:%!xxd -r</code>) and save it (<code>:w</code>)</p>
<h2><span id="writing-new-regulations-in-eeprom">Writing New Regulations in EEPROM</span></h2><p>After finishing modification, rewrite EEPROM with <code>iwleeprom -m -c -i &lt;infile&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ iwleeprom -m -c -i eeprom_dump</span><br><span class="line">Supported devices detected:</span><br><span class="line">[1] 0000:03:00.0 [RW] Ultimate N WiFi Link 5300 (8086:4236, 8086:1011)</span><br><span class="line">Select device [1-1] (or 0 to quit): 1</span><br><span class="line">Using device 0000:03:00.0 [RW] Ultimate N WiFi Link 5300</span><br><span class="line">Dump file byte order: BIG ENDIAN</span><br><span class="line">0000 [================================================================]</span><br><span class="line">0080 [================================================================]</span><br><span class="line">...</span><br><span class="line">0780 [================================================================]</span><br><span class="line"></span><br><span class="line">EEPROM has been written from eeprom_dump</span><br></pre></td></tr></table></figure>

<p>Finally, you can check modification is applied via <code>iw phy</code> command</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
    <a href="/" class="alignleft prev">Prev</a>
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="jeon.engineer">
  </form>
</div>


  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/antlr4/">ANTLR4</a><small>3</small></li>
  
    <li><a href="/tags/amazon/">Amazon</a><small>1</small></li>
  
    <li><a href="/tags/ant-design/">Ant Design</a><small>1</small></li>
  
    <li><a href="/tags/dw1000/">DW1000</a><small>1</small></li>
  
    <li><a href="/tags/dwm1000/">DWM1000</a><small>1</small></li>
  
    <li><a href="/tags/decawave/">DecaWave</a><small>2</small></li>
  
    <li><a href="/tags/evk1000/">EVK1000</a><small>1</small></li>
  
    <li><a href="/tags/electron/">Electron</a><small>2</small></li>
  
    <li><a href="/tags/git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/github-action/">GitHub Action</a><small>1</small></li>
  
    <li><a href="/tags/hexo/">Hexo</a><small>1</small></li>
  
    <li><a href="/tags/intel/">Intel</a><small>1</small></li>
  
    <li><a href="/tags/openapi/">OpenAPI</a><small>1</small></li>
  
    <li><a href="/tags/react/">React</a><small>1</small></li>
  
    <li><a href="/tags/rust/">Rust</a><small>3</small></li>
  
    <li><a href="/tags/ssl-certificate/">SSL certificate</a><small>1</small></li>
  
    <li><a href="/tags/trek1000/">TREK1000</a><small>1</small></li>
  
    <li><a href="/tags/thrift/">Thrift</a><small>1</small></li>
  
    <li><a href="/tags/typescript/">TypeScript</a><small>1</small></li>
  
    <li><a href="/tags/uml/">UML</a><small>1</small></li>
  
    <li><a href="/tags/uwb/">UWB</a><small>2</small></li>
  
    <li><a href="/tags/wi-fi/">Wi-Fi</a><small>1</small></li>
  
    <li><a href="/tags/algorithm/">algorithm</a><small>1</small></li>
  
    <li><a href="/tags/axios/">axios</a><small>1</small></li>
  
    <li><a href="/tags/dnd-kit/">dnd kit</a><small>1</small></li>
  
    <li><a href="/tags/email/">email</a><small>1</small></li>
  
    <li><a href="/tags/optimization/">optimization</a><small>1</small></li>
  
    <li><a href="/tags/positioning/">positioning</a><small>3</small></li>
  
    <li><a href="/tags/privacy/">privacy</a><small>1</small></li>
  
    <li><a href="/tags/problem-solving/">problem solving</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/recursion/">recursion</a><small>1</small></li>
  
    <li><a href="/tags/trilateration/">trilateration</a><small>2</small></li>
  
    <li><a href="/tags/web-font/">web font</a><small>1</small></li>
  
    <li><a href="/tags/webpack/">webpack</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2024 Seokseong Jeon
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
