<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Jeon, an engineer</title>
  <meta name="author" content="Seokseong Jeon">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jeon, an engineer"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeon, an engineer</a></h1>
  <h2><a href="/">Write the unwritten</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a target="_blank" rel="noopener" href="https://github.com/internalstability/hexo-src/issues/new">✒</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article id="post-axios-with-proxy-and-custom-ssl-certificate" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2021-08-26T14:13:12.000Z"><a href="/2021/08/26/axios-with-proxy-and-custom-ssl-certificate/">2021-08-26</a></time>
      
      
  
    <h1 class="title"><a href="/2021/08/26/axios-with-proxy-and-custom-ssl-certificate/">axios with proxy and custom SSL certificate</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>This article summarizes what made me struggle days.</p>
<h2><span id="fix-https-proxy-agent-to-support-ca">Fix <code>https-proxy-agent</code> to support CA</span></h2><p>It was originally proposed <a target="_blank" rel="noopener" href="https://github.com/TooTallNate/node-https-proxy-agent/issues/89#issuecomment-688353505">here</a> by <a target="_blank" rel="noopener" href="https://github.com/maslakov">maslakov</a>.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpsProxyAgent</span>, <span class="title class_">HttpsProxyAgentOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;https-proxy-agent&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ClientRequest</span>, <span class="title class_">RequestOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;agent-base&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Socket</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;net&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PatchedHttpsProxyAgent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HttpsProxyAgent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">ca</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">opts: HttpsProxyAgentOptions</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(opts);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ca</span> = opts.<span class="property">ca</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">callback</span>(<span class="attr">req</span>: <span class="title class_">ClientRequest</span>, <span class="attr">opts</span>: <span class="title class_">RequestOptions</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Socket</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">callback</span>(req, <span class="title class_">Object</span>.<span class="title function_">assign</span>(opts, &#123; <span class="attr">ca</span>: <span class="variable language_">this</span>.<span class="property">ca</span> &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2><span id="working-prototype">Working prototype</span></h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HttpsProxyAgent</span> = <span class="built_in">require</span>(<span class="string">&#x27;https-proxy-agent&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ca = <span class="built_in">require</span>(<span class="string">&#x27;ssl-root-cas/latest&#x27;</span>).<span class="title function_">create</span>();</span><br><span class="line"></span><br><span class="line">ca.<span class="title function_">addFile</span>(certificateFilePath);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpsAgent = <span class="keyword">new</span> <span class="title class_">HttpsProxyAgent</span>(&#123;</span><br><span class="line">  <span class="attr">protocol</span>: <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;proxy_host&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">  ca,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">httpsAgent</span> = httpsAgent;</span><br></pre></td></tr></table></figure>

<h2><span id="references">References</span></h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/TooTallNate/node-https-proxy-agent/issues/89#issuecomment-688353505">PatchedHttpsProxyAgent</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-building-github-action-to-publish-hexo-post-from-github-issue" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2021-07-28T11:20:45.000Z"><a href="/2021/07/28/building-github-action-to-publish-hexo-post-from-github-issue/">2021-07-28</a></time>
      
      
  
    <h1 class="title"><a href="/2021/07/28/building-github-action-to-publish-hexo-post-from-github-issue/">Building GitHub Action to publish Hexo post from GitHub Issue</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>I wanted to write and publish a Hexo post without tedious commands such as <code>git clone</code>, <code>git pull</code>, <code>hexo new</code>, <code>hexo generate</code>, <code>git commit</code> and <code>git push</code>. I saw the feasibility to build an automated publishing system using GitHub Issue and GitHub Actions for this purpose.</p>
<p>Here’s workflow what I thought:</p>
<ul>
<li>A user makes an issue, a draft of a post on GitHub Issue</li>
<li>GitHub Workflow is triggered against the issue</li>
<li>The workflow converts the issue to a Hexo post</li>
</ul>
<p><strong>GitHub Issue</strong></p>
<p>I thought that GitHub Issue is a perfect system to draft a post. It has a title, a content and a date&#x2F;time of update and those information can be a title, a content and a date&#x2F;time of a post. One thing missing is tags of a post. To achieve this, I got an idea to use labels of an issue as tags of a post.</p>
<p><strong>GitHub Action</strong></p>
<p>I did a research whether there exists GitHub Actions converting an issue to a Hexo post, but I found nothing. So I decided to build a GitHub Action for it.</p>
<p>First of all, it takes two parameters, <code>issue_url</code> and <code>token</code> and extracts <code>endpoint</code> from <code>issue_url</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> core <span class="keyword">from</span> <span class="string">&#x27;@actions/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> issueUrl = core.<span class="title function_">getInput</span>(<span class="string">&#x27;issue_url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> index = issueUrl.<span class="title function_">indexOf</span>(<span class="string">&#x27;/repos&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> endpoint = issueUrl.<span class="title function_">substring</span>(index);</span><br><span class="line"><span class="keyword">const</span> token = core.<span class="title function_">getInput</span>(<span class="string">&#x27;token&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>And then, it initializes Hexo:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Hexo</span> <span class="keyword">from</span> <span class="string">&#x27;hexo&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hexo = <span class="keyword">new</span> <span class="title class_">Hexo</span>(process.<span class="title function_">cwd</span>(), &#123;&#125;);</span><br><span class="line">hexo.<span class="title function_">init</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Described below</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    core.<span class="title function_">setFailed</span>(reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>After Hexo is initialized, it retrieves information of an issue:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Octokit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;octokit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// After resolving `hexo.init()`</span></span><br><span class="line"><span class="keyword">const</span> gh = <span class="keyword">new</span> <span class="title class_">Octokit</span>(&#123; <span class="attr">auth</span>: token &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Converting issue <span class="subst">$&#123;endpoint&#125;</span> to Hexo post...`</span>);</span><br><span class="line">gh.<span class="title function_">request</span>(<span class="string">`GET <span class="subst">$&#123;endpoint&#125;</span>`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; title, <span class="attr">updated_at</span>: date, labels, milestone, <span class="attr">body</span>: content &#125; = response.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">// Described below</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    core.<span class="title function_">setFailed</span>(reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>If a draft is set to be published, it derives tags and creates a Hexo post:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">MILESTONE_PUBLISH</span> = <span class="string">&#x27;publish&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (milestone.<span class="property">title</span> !== <span class="variable constant_">MILESTONE_PUBLISH</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Issue does not have milestone <span class="subst">$&#123;MILESTONE_PUBLISH&#125;</span>`</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tags = labels.<span class="title function_">map</span>(<span class="function">(<span class="params">label: <span class="built_in">any</span></span>) =&gt;</span> label.<span class="property">name</span>);</span><br><span class="line">    hexo.<span class="property">post</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        title,</span><br><span class="line">        date,</span><br><span class="line">        tags,</span><br><span class="line">        content,</span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="built_in">any</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At this point, a markdown file is generated and further actions to be prepared to complete publishing a post. The complete implementation of this action can be found <a target="_blank" rel="noopener" href="https://github.com/internalstability/action-issue-to-hexo">here</a>.</p>
<p><strong>Workflow</strong></p>
<p>Now a complete workflow needs to be setup. The workflow below converts an issue to a post and pushes it to the repository:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Issue</span> <span class="string">to</span> <span class="string">Hexo</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">issues:</span></span><br><span class="line">    <span class="comment"># Sufficient to trigger this workflow when an issue is milestoned</span></span><br><span class="line">    <span class="attr">types:</span> [ <span class="string">milestoned</span> ]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">internalstability/action-issue-to-hexo@v1.0.0</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">issue_url:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.issue.url</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment"># Personal access token used to get information of Issue</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.token</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="comment"># At this point, a markdown file is generated and untracked</span></span><br><span class="line">      <span class="comment"># Take further action, e.g. generate (`hexo generate`), commit and push</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Commit</span> <span class="string">post</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git add .</span></span><br><span class="line"><span class="string">          git config user.name &quot;issue-to-hexo bot&quot;</span></span><br><span class="line"><span class="string">          git config.user.email &quot;&lt;&gt;&quot;</span></span><br><span class="line"><span class="string">          git commit -m &quot;Add a post&quot;</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">ad-m/github-push-action@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.token</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>I have another workflow which generates (<code>hexo generate</code>) a blog from the pushed code. I made two separate workflows because I both use GitHub Issue to draft a post and manually write and push a markdown draft on my PC. Here’s the workflow:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Publish</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">master</span> ]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;14&#x27;</span></span><br><span class="line">      <span class="comment"># This submodule is a directory that contains generated Hexo blog</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">submodule</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          cd public</span></span><br><span class="line"><span class="string">          git checkout master</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string">          npm run build</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Commit</span> <span class="string">submodule</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          cd public</span></span><br><span class="line"><span class="string">          git add .</span></span><br><span class="line"><span class="string">          git config user.name &quot;internalstability/hexo-src bot&quot;</span></span><br><span class="line"><span class="string">          git config user.email &quot;&lt;&gt;&quot;</span></span><br><span class="line"><span class="string">          git commit -m &quot;Publish&quot;</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span> <span class="string">submodule</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">ad-m/github-push-action@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.token</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">directory:</span> <span class="string">&#x27;public&#x27;</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">&#x27;internalstability/internalstability.github.io&#x27;</span></span><br><span class="line">      <span class="comment"># These actions commits and pushes the submodule to the main module</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Commit</span> <span class="string">main</span> <span class="string">module</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git add .</span></span><br><span class="line"><span class="string">          git config user.name &quot;internalstability/hexo-src bot&quot;</span></span><br><span class="line"><span class="string">          git config user.email &quot;&lt;&gt;&quot;</span></span><br><span class="line"><span class="string">          git commit -m &quot;Publish&quot;</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span> <span class="string">main</span> <span class="string">module</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">ad-m/github-push-action@master</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-drag-sorting-ant-design-table-with-dnd-kit" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2021-07-16T00:00:00.000Z"><a href="/2021/07/16/drag-sorting-ant-design-table-with-dnd-kit/">2021-07-16</a></time>
      
      
  
    <h1 class="title"><a href="/2021/07/16/drag-sorting-ant-design-table-with-dnd-kit/">Drag sorting Ant Design Table with dnd kit</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#prepare-dummy-data">Prepare dummy data</a></li>
<li><a href="#define-a-state-variable-for-drag-overlay">Define a state variable for drag overlay</a></li>
<li><a href="#convert-table-into-sortable-preset-of-dnd-kit">Convert <code>Table</code> into sortable preset of dnd kit</a></li>
<li><a href="#draggablewrapper">DraggableWrapper</a></li>
<li><a href="#draggablerow">DraggableRow</a></li>
<li><a href="#handledragstart">handleDragStart</a></li>
<li><a href="#handledragend">handleDragEnd</a></li>
</ul>
<!-- tocstop -->

<h2><span id="introduction">Introduction</span></h2><p>I was trying to implement <a target="_blank" rel="noopener" href="https://ant.design/components/table/#components-table-demo-drag-sorting-handler">Drag sorting with handler</a> for Ant Design Table. I found that <a target="_blank" rel="noopener" href="https://github.com/clauderic/react-sortable-hoc">react-sortable-hoc</a> is not going to be enhancement further and the author encourages to use <a target="_blank" rel="noopener" href="https://github.com/clauderic/dnd-kit">dnd kit</a>. This article summarizes what I did to implement  it with dnd kit.</p>
<h2><span id="prepare-dummy-data">Prepare dummy data</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> columns = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&quot;dragHandle&quot;</span>, <span class="attr">dataIndex</span>: <span class="string">&quot;dragHandle&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;Drag&quot;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">30</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">MenuOutlined</span> /&gt;</span></span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&quot;key&quot;</span>, <span class="attr">dataIndex</span>: <span class="string">&quot;key&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;Key&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dataSourceRaw = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">5</span>).<span class="title function_">fill</span>(&#123;&#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// This will be transformed into `data-row-key` of props.</span></span><br><span class="line">    <span class="comment">// Shall be truthy to be draggable. I don&#x27;t know why.</span></span><br><span class="line">    <span class="comment">// To this end, index of number type is converted into string.</span></span><br><span class="line">    <span class="attr">key</span>: index.<span class="title function_">toString</span>(),</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">const</span> [dataSource, setDataSource] = <span class="title function_">useState</span>(dataSourceRaw);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p>The important thing here is that the <span style="background-color: #ff0;"><strong>key used to identify an item must be truthy value.</strong></span> I struggled with a situation that the first item is not draggable. After some minutes of debugging, I found that if the key is falsy value, it is not draggable. But I couldn’t find the root cause for this.</p>
<h2><span id="define-a-state-variable-for-drag-overlay">Define a state variable for drag overlay</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ID to render overlay.</span></span><br><span class="line"><span class="keyword">const</span> [activeId, setActiveId] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p><code>activeId</code> will be used for determining whether to render drag overlay or not.</p>
<h2><span id="convert-table-into-sortable-preset-of-dnd-kit">Convert <code>Table</code> into sortable preset of dnd kit</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sensors = <span class="title function_">useSensors</span>(</span><br><span class="line">  <span class="title function_">useSensor</span>(<span class="title class_">PointerSensor</span>),</span><br><span class="line">  <span class="title function_">useSensor</span>(<span class="title class_">KeyboardSensor</span>, &#123;</span><br><span class="line">    <span class="attr">coordinateGetter</span>: sortableKeyboardCoordinates,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">DndContext</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">sensors</span>=<span class="string">&#123;sensors&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">collisionDetection</span>=<span class="string">&#123;closestCenter&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onDragEnd</span>=<span class="string">&#123;handleDragEnd&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">components</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">body:</span> &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">wrapper:</span> <span class="attr">DraggableWrapper</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">row:</span> <span class="attr">DraggableRow</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* Render overlay component. */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">DragOverlay</span>&gt;</span>&#123;activeId ? activeId : null&#125;<span class="tag">&lt;/<span class="name">DragOverlay</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">DndContext</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>According to <a target="_blank" rel="noopener" href="https://docs.dndkit.com/presets/sortable#single-container">sortable single container</a>, enclose <code>Table</code> in <code>DndContext</code>, wrap body (<code>tbody</code>) with <code>SortableContext</code> and implement <code>useSortable</code> in row (<code>tr</code>). In this example, <code>DraggableWrapper</code> implements <code>SortableContext</code> and <code>DraggableRow</code> implements <code>tr</code> with <code>useSortrable</code>.</p>
<p><code>DragOverlay</code> is rendered only when <code>activeId</code> has a valid ID value.</p>
<h2><span id="draggablewrapper">DraggableWrapper</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">DraggableWrapper</span>(<span class="params">props: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; children, ...restProps &#125; = props;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * &#x27;children[1]` is `dataSource`</span></span><br><span class="line"><span class="comment">   * Check if `children[1]` is an array</span></span><br><span class="line"><span class="comment">   * because antd gives &#x27;No Data&#x27; element when `dataSource` is an empty array</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">SortableContext</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">items</span>=<span class="string">&#123;children[1]</span> <span class="attr">instanceof</span> <span class="attr">Array</span> ? <span class="attr">children</span>[<span class="attr">1</span>]<span class="attr">.map</span>((<span class="attr">child:</span> <span class="attr">any</span>) =&gt;</span> child.key) : []&#125;</span></span><br><span class="line"><span class="language-xml">      strategy=&#123;verticalListSortingStrategy&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;...restProps&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">tbody</span> &#123;<span class="attr">...restProps</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;</span></span><br><span class="line"><span class="language-xml">          // This invokes `Table.components.body.row` for each element of `children`.</span></span><br><span class="line"><span class="language-xml">          children</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">SortableContext</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DraggableWrapper</code> implements <code>SortableContext</code>. <code>items</code> shall be a list of keys to identify items, not items themselves. Inside <code>tbody</code>, <code>children</code> is a list of rows and each item will invoke <code>Table.components.body.row</code>, which is <code>DraggableRow</code>.</p>
<h2><span id="draggablerow">DraggableRow</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">DraggableRow</span>(<span class="params">props: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; attributes, listeners, setNodeRef &#125; = <span class="title function_">useSortable</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: props[<span class="string">&quot;data-row-key&quot;</span>],</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> &#123; children, ...restProps &#125; = props;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * &#x27;children[1]` is a row of `dataSource`</span></span><br><span class="line"><span class="comment">   * Check if `children[1]` is an array</span></span><br><span class="line"><span class="comment">   * because antd gives &#x27;No Data&#x27; element when `dataSource` is an empty array</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">tr</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">ref</span>=<span class="string">&#123;setNodeRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...attributes</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...restProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;</span></span><br><span class="line"><span class="language-xml">        children instanceof Array ? (</span></span><br><span class="line"><span class="language-xml">          children.map((child: any) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            const &#123; children, key, ...restProps &#125; = child;</span></span><br><span class="line"><span class="language-xml">            return key === &quot;dragHandle&quot; ? (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">td</span> &#123;<span class="attr">...listeners</span>&#125; &#123;<span class="attr">...restProps</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;child&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ) : (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">td</span> &#123;<span class="attr">...restProps</span>&#125;&gt;</span>&#123;child&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            );</span></span><br><span class="line"><span class="language-xml">          &#125;)</span></span><br><span class="line"><span class="language-xml">        ) : (</span></span><br><span class="line"><span class="language-xml">          children</span></span><br><span class="line"><span class="language-xml">        )</span></span><br><span class="line"><span class="language-xml">      &#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DraggableRow</code> implements <code>tr</code> with <code>useSortable</code>, where <code>id</code> must be the same with a <code>key</code> of each item. We want to make a row draggable, so assign <code>setNodRef</code> to <code>tr</code>. And we want to enable dragging only when a user grabs a drag handle, so assign <code>listeners</code> to <code>td</code> containing a drag handle.</p>
<h2><span id="handledragstart">handleDragStart</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleDragStart</span>(<span class="params">event: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; active &#125; = event;</span><br><span class="line">  <span class="title function_">setActiveId</span>(active.<span class="property">id</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2><span id="handledragend">handleDragEnd</span></h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleDragEnd</span>(<span class="params">event: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; active, over &#125; = event;</span><br><span class="line">  <span class="keyword">if</span> (active.<span class="property">id</span> !== over.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="title function_">setDataSource</span>(<span class="function">(<span class="params">items</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// In this example, find an item, where `item.key` === `useSortable.id`.</span></span><br><span class="line">      <span class="keyword">const</span> oldIndex = items.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">key</span> === active.<span class="property">id</span>);</span><br><span class="line">      <span class="keyword">const</span> newIndex = items.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">key</span> === over.<span class="property">id</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">arrayMove</span>(items, oldIndex, newIndex);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Stop overlay.</span></span><br><span class="line">  <span class="title function_">setActiveId</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>handleDragEnd</code> performs swapping two items. Here, to find indexes of two items in data source, we need to compare <code>key</code> of an item and <code>id</code> of <code>useSortable</code>. </p>
<p>You can find demo <a target="_blank" rel="noopener" href="https://codesandbox.io/s/frosty-mahavira-i17ph">here</a>.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-quick-start-on-antlr4-in-rust-part3" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-06-10T00:00:00.000Z"><a href="/2020/06/10/quick-start-on-antlr4-in-rust-part3/">2020-06-10</a></time>
      
      
  
    <h1 class="title"><a href="/2020/06/10/quick-start-on-antlr4-in-rust-part3/">Quick start on ANTLR4 in Rust - part3</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><em>This is my note in adopting and learning ANTLR4Rust</em></p>
<p><strong>Series</strong></p>
<ul>
<li><a href="/2020/05/29/quick-start-on-antlr4-in-rust-part1">Quick Start on ANTLR4 in Rust — Part1</a></li>
<li><a href="/2020/06/02/quick-start-on-antlr4-in-rust-part2">Quick Start on ANTLR4 in Rust — Part2</a></li>
<li>Quick Start on ANTLR4 in Rust — Part3 (This article)</li>
</ul>
<hr>
<p>In the previous article, we implemented a parser with internal state variables. However, if a grammar is huge, it is practically impossible to manage a huge number of state variables. Alternatively, a visitor-like approach can be used.</p>
<p>In an exit method of the root rule in the Listener, we can grab the current context and its children and call custom parser methods:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">hdr</span>(&amp;<span class="keyword">self</span>, ctx: &amp;HdrContextAll) <span class="punctuation">-&gt;</span> Row &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">row_ctx</span> = ctx.<span class="title function_ invoke__">row</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">row</span>(&amp;row_ctx)</span><br><span class="line">    &#125;    <span class="keyword">fn</span> <span class="title function_">row</span>(&amp;<span class="keyword">self</span>, ctx: &amp;RowContextAll) <span class="punctuation">-&gt;</span> Row &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">row</span> = Row::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">field_ctx_list</span> = ctx.<span class="title function_ invoke__">field_all</span>();</span><br><span class="line">        <span class="title function_ invoke__">for</span> (_i, field_ctx) <span class="keyword">in</span> field_ctx_list.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">field</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">field</span>(&amp;field_ctx);</span><br><span class="line">            row.<span class="title function_ invoke__">push</span>(field);</span><br><span class="line">        &#125;</span><br><span class="line">        row</span><br><span class="line">    &#125;    <span class="keyword">fn</span> <span class="title function_">field</span>(&amp;<span class="keyword">self</span>, ctx: &amp;FieldContextAll) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        ctx.<span class="title function_ invoke__">get_text</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">CSVListener</span> <span class="keyword">for</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ctx: &amp;CsvFileContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">hdr_ctx</span> = ctx.<span class="title function_ invoke__">hdr</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">header</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">hdr</span>(&amp;hdr_ctx);</span><br><span class="line">        <span class="keyword">self</span>.csv.header = header;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">row_ctx_list</span> = ctx.<span class="title function_ invoke__">row_all</span>();</span><br><span class="line">        <span class="title function_ invoke__">for</span> (_i, row_ctx) <span class="keyword">in</span> row_ctx_list.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">row</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">row</span>(&amp;row_ctx);</span><br><span class="line">            <span class="keyword">self</span>.csv.rows.<span class="title function_ invoke__">push</span>(row);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The minimal working example can be found <a target="_blank" rel="noopener" href="https://github.com/internalstability/antlr4rust_quickstart/commit/541cd68c7587e62263242df5a2998a5e9dff71ce">here</a>.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-quick-start-on-antlr4-in-rust-part2" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-06-02T00:00:00.000Z"><a href="/2020/06/02/quick-start-on-antlr4-in-rust-part2/">2020-06-02</a></time>
      
      
  
    <h1 class="title"><a href="/2020/06/02/quick-start-on-antlr4-in-rust-part2/">Quick start on ANTLR4 in Rust - part2</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><em>This is my note in adopting and learning ANTLR4Rust</em></p>
<p><strong>Series</strong></p>
<ul>
<li><a href="/2020/05/29/quick-start-on-antlr4-in-rust-part1">Quick Start on ANTLR4 in Rust — Part1</a></li>
<li>Quick Start on ANTLR4 in Rust — Part2 (This article)</li>
<li><a href="/2020/06/10/quick-start-on-antlr4-in-rust-part3">Quick Start on ANTLR4 in Rust — Part3</a></li>
</ul>
<hr>
<p>In the previous article, we built the minimal working example walking a parse tree using a listener. In this article, we are going to store a parsed CSV structure into a variable to use in the future.</p>
<p>Define a CSV structure:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Row</span> = <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;;<span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CSV</span> &#123;</span><br><span class="line">    header: Row,</span><br><span class="line">    rows: <span class="type">Vec</span>&lt;Row&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Add fields to a listener:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    csv: <span class="type">Box</span>&lt;CSV&gt;,</span><br><span class="line">    add_to_header: <span class="type">bool</span>,</span><br><span class="line">    row_to_add: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>csv</code> will be a resultant CSV structure. <code>add_to_header</code> and <code>row_to_add</code> are internal state variables to generate a CSV structure.</p>
<p>Implement a listener:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">CSVListener</span> <span class="keyword">for</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;CsvFileContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;CsvFileContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_hdr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;HdrContext) &#123;</span><br><span class="line">        <span class="keyword">self</span>.add_to_header = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_hdr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;HdrContext) &#123;</span><br><span class="line">        <span class="keyword">self</span>.csv.header = <span class="keyword">self</span>.row_to_add.<span class="title function_ invoke__">to_vec</span>();</span><br><span class="line">        <span class="keyword">self</span>.row_to_add.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">        <span class="keyword">self</span>.add_to_header = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_row</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;RowContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_row</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;RowContext) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.add_to_header &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.csv.rows.<span class="title function_ invoke__">push</span>(<span class="keyword">self</span>.row_to_add.<span class="title function_ invoke__">to_vec</span>());</span><br><span class="line">        <span class="keyword">self</span>.row_to_add.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_field</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;FieldContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_field</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;FieldContext) &#123;</span><br><span class="line">        <span class="keyword">self</span>.row_to_add.<span class="title function_ invoke__">push</span>(_ctx.<span class="title function_ invoke__">get_text</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Feed an input to a parse and extract the result:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line">        <span class="string">&quot;This, is, a, header</span></span><br><span class="line"><span class="string">This, is, a, row</span></span><br><span class="line"><span class="string">&quot;</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lexer</span> = CSVLexer::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(InputStream::<span class="title function_ invoke__">new</span>(input)));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">token_source</span> = CommonTokenStream::<span class="title function_ invoke__">new</span>(lexer);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">parser</span> = CSVParser::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(token_source));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">listener_id</span> = parser.<span class="title function_ invoke__">add_parse_listener</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Listener &#123;</span><br><span class="line">        csv: <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(CSV &#123;</span><br><span class="line">            header: Row::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            rows: <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;),</span><br><span class="line">        add_to_header: <span class="literal">false</span>,</span><br><span class="line">        row_to_add: Row::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = parser.<span class="title function_ invoke__">csvFile</span>();</span><br><span class="line">    <span class="built_in">assert!</span>(result.<span class="title function_ invoke__">is_ok</span>());</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">listener</span> = parser.<span class="title function_ invoke__">remove_parse_listener</span>(listener_id);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">csv</span> = listener.csv;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#?&#125;&quot;</span>, csv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A tricky part is that we have to extract <code>csv</code> from <code>listener</code>. And to this end, we have to extract <code>listener</code> with <code>listener_id</code>.</p>
<p>The minimal working example can be found <a target="_blank" rel="noopener" href="https://github.com/internalstability/antlr4rust_quickstart/commit/0bc40c180d782d044097f68b756fdba6c5f82da0">here</a>.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-quick-start-on-antlr4-in-rust-part1" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-05-29T00:00:00.000Z"><a href="/2020/05/29/quick-start-on-antlr4-in-rust-part1/">2020-05-29</a></time>
      
      
  
    <h1 class="title"><a href="/2020/05/29/quick-start-on-antlr4-in-rust-part1/">Quick start on ANTLR4 in Rust - part1</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><em>This is my note in adopting and learning ANTLR4Rust</em></p>
<p><strong>Series</strong></p>
<ul>
<li>Quick Start on ANTLR4 in Rust — Part1 (This article)</li>
<li><a href="/2020/06/02/quick-start-on-antlr4-in-rust-part2">Quick Start on ANTLR4 in Rust — Part2</a></li>
<li><a href="/2020/06/10/quick-start-on-antlr4-in-rust-part3">Quick Start on ANTLR4 in Rust — Part3</a></li>
</ul>
<hr>
<p>Install nightly version of Rust (and make it default if you want for convenience).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rustup toolchain install nightly</span><br><span class="line">$ rustup default nightly</span><br></pre></td></tr></table></figure>

<p>Get ANTLR4 runtime for Rust from <a target="_blank" rel="noopener" href="https://github.com/rrevenantt/antlr4rust/releases">here</a>:</p>
<p>Prepare a grammar. I will use an example grammar: <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/antlr/grammars-v4/master/csv/CSV.g4">https://raw.githubusercontent.com/antlr/grammars-v4/master/csv/CSV.g4</a></p>
<p>Generate a parser:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar &lt;ANTLR4 runtime path&gt; -Dlanguage=Rust CSV.g4</span><br></pre></td></tr></table></figure>

<p>You will get <code>csvlexer.rs</code>, <code>csvlistener.rs</code> , <code>csvparser.rs</code> . Place them into your project <code>src</code> directory.</p>
<p>Add dependencies in <code>Cargo.toml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dependencies]</span><br><span class="line">lazy_static = &quot;1.4&quot;</span><br><span class="line">antlr-rust = &quot;0.1&quot;</span><br></pre></td></tr></table></figure>

<p>Add a feature and import <code>lazy_static</code> macros to the root module:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(try_blocks)]</span></span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> crates lazy_static;</span><br></pre></td></tr></table></figure>

<p>Import common and essential things:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> antlr_rust::common_token_stream::CommonTokenStream;</span><br><span class="line"><span class="keyword">use</span> antlr_rust::input_stream::InputStream;</span><br><span class="line"><span class="keyword">use</span> antlr_rust::parser_rule_context::ParserRuleContext;</span><br><span class="line"><span class="keyword">use</span> antlr_rust::tree::&#123;ErrorNode, ParseTreeListener, TerminalNode&#125;;</span><br></pre></td></tr></table></figure>

<p>Import grammar-specific things:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> csvlexer;</span><br><span class="line"><span class="keyword">mod</span> csvlistener;</span><br><span class="line"><span class="keyword">mod</span> csvparser;</span><br><span class="line"><span class="keyword">use</span> csvlexer::CSVLexer;</span><br><span class="line"><span class="keyword">use</span> csvlistener::CSVListener;</span><br><span class="line"><span class="keyword">use</span> csvparser::*;</span><br></pre></td></tr></table></figure>

<p>Implement <code>ParseTreeListener</code>, a supertraint of <code>CSVListener</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Listener</span>;<span class="keyword">impl</span> <span class="title class_">ParseTreeListener</span> <span class="keyword">for</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_terminal</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, node: &amp;TerminalNode) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_error_node</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, node: &amp;ErrorNode) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_every_rule</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ctx: &amp;<span class="keyword">dyn</span> ParserRuleContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_every_rule</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ctx: &amp;<span class="keyword">dyn</span> ParserRuleContext) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Implement <code>CSVListener</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">CSVListener</span> <span class="keyword">for</span> <span class="title class_">Listener</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;CsvFileContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_csvFile</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;CsvFileContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_hdr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;HdrContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_hdr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;HdrContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_row</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;RowContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_row</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;RowContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enter_field</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;FieldContext) &#123;&#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">exit_field</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _ctx: &amp;FieldContext) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Read and parse an input. Note that <code>csvFile</code> in the last line is a rule name in <code>CSV.g4</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line"><span class="string">&quot;This, is, a, header</span></span><br><span class="line"><span class="string">This, is, a, row</span></span><br><span class="line"><span class="string">&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lexer</span> = CSVLexer::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(InputStream::<span class="title function_ invoke__">new</span>(input)));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">token_source</span> = CommonTokenStream::<span class="title function_ invoke__">new</span>(lexer);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">parser</span> = CSVParser::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(token_source));</span><br><span class="line">    parser.<span class="title function_ invoke__">add_parse_listener</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Listener &#123;&#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = parser.<span class="title function_ invoke__">csvFile</span>();</span><br><span class="line">    <span class="built_in">assert!</span>(result.<span class="title function_ invoke__">is_ok</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The minimal working example can be found <a target="_blank" rel="noopener" href="https://github.com/internalstability/antlr4rust_quickstart/commit/1a4fb82e23bf9c5a33ed2298ef875f1fee80151f">here</a>.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-trilateration-using-the-levenberg-marquardt-method" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-05-29T00:00:00.000Z"><a href="/2020/05/29/trilateration-using-the-levenberg-marquardt-method/">2020-05-29</a></time>
      
      
  
    <h1 class="title"><a href="/2020/05/29/trilateration-using-the-levenberg-marquardt-method/">Trilateration using the Levenberg-Marquardt method</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <blockquote>
<p>True range multilateration is a method to determine the location of a movable vehicle or stationary point in space using multiple ranges (distances) between the vehicle&#x2F;point and multiple spatially-separated known locations (often termed ‘stations’). — True range multilateration, Wikipedia</p>
</blockquote>
<p>We can define a trilateration as an optimization problem to minimize a cost function \(S\) for a given estimate \(\beta\)<em>,</em> a tuple of \((x, y, z)\)</p>
<p>$$\begin{aligned}<br>S(\beta)&amp;&#x3D;\sum_{i&#x3D;1}^{N}f_i(\beta)\\<br>&amp;&#x3D;\sum_{i&#x3D;1}^{N}\left[r_i-\sqrt{(x-X_i)^2+(y-Y_i)^2+(z-Z_i)^2}\right]^2<br>\end{aligned}$$</p>
<p>where \(r_i\) is a measured distnace between an Anchor (i), whose coordinates are \((X_i, Y_i, Z_i)\).</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Levenberg-Marquardt_algorithm">Levenberg-Marquardt method</a> is defined by:</p>
<p>$$\beta_{k+1}&#x3D;\beta_k-\left(J^TJ+\mu_kdiag\left(J^TJ\right)\right)^{-1}J^Tf(\beta_k)$$</p>
<p>where \(J\) is the Jacobian matrix and \(f\) is a column vector composed of \(f_i\):</p>
<p>$$\begin{aligned}<br>J&amp;&#x3D;\begin{bmatrix}<br>\frac{\partial f_1}{\partial x} &amp; \frac{\partial f_1}{\partial y} &amp; \frac{\partial f_1}{\partial z} \\<br>\frac{\partial f_2}{\partial x} &amp; \frac{\partial f_2}{\partial y} &amp; \frac{\partial f_2}{\partial z} \\<br>\vdots &amp; \vdots &amp; \vdots \\<br>\frac{\partial f_N}{\partial x} &amp; \frac{\partial f_N}{\partial y} &amp; \frac{\partial f_N}{\partial z}<br>\end{bmatrix}\\<br>&amp;&#x3D;\begin{bmatrix}<br>F_1(x-X_1) &amp; F_1(y-Y_1) &amp; F_1(z-Z_1) \\<br>F_2(x-X_2) &amp; F_2(y-Y_2) &amp; F_2(z-Z_2) \\<br>\vdots &amp; \vdots &amp; \vdots \\<br>F_N(x-X_N) &amp; F_N(y-Y_N) &amp; F_N(z-Z_N)<br>\end{bmatrix}<br>\end{aligned}$$</p>
<p>where \(F_i\) is a shorthand of each derivative:</p>
<p>$$F_i&#x3D;\frac{r_i}{\sqrt{(x-X_i)^2+(y-Y_i)^2+(z-Z_i)^2}}$$</p>
<p>Now, we can estimate \(\beta\) by iterating the equation until it converges.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-positioning-system-using-decawave-dw1000" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-08-24T00:00:00.000Z"><a href="/2017/08/24/positioning-system-using-decawave-dw1000/">2017-08-24</a></time>
      
      
  
    <h1 class="title"><a href="/2017/08/24/positioning-system-using-decawave-dw1000/">Positioning system using DecaWave DW1000</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2><span id="decawaves-dw1000">DecaWave’s DW1000</span></h2><p><a target="_blank" rel="noopener" href="https://decawave.com/products/dw1000">DW1000</a> is a UWB communication and ranging module manufactured by DecaWave.<br>It provides a fairly good ranging accuracy (&lt; 2 cm).  Not only a simple anchor-tag ranging system, let’s make a practical centimeter-level precision indoor positioning system using it</p>
<h2><span id="system-design">System Design</span></h2><h3><span id="overview">Overview</span></h3><p>A setup is shown in a figure below:</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/overview.png" class>

<ul>
<li>A tag<ul>
<li>A tag is composed of two components—Raspberry Pi and Arduino Pro Mini</li>
<li>Raspberry Pi controles a higher level indoor positioning system<ul>
<li>It triggers Arduino Pro Mini to probe anchors and measure distance between it and each anchor</li>
<li>It requests distance measurements on Arduino Pro Mini and locate itself through trilateration</li>
</ul>
</li>
<li>Arduino Pro Mini<ul>
<li>It is required due to similar reasons of anchors</li>
<li>It receives commands from Raspberry Pi and executes the corresponding process<br>  Processes are:<ul>
<li>Probing anchors nearby and exchanging series of frames with each anchor<br>  to measure distance</li>
<li>Reporting probed anchors and measured distance values</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Anchors<ul>
<li>They are deployed in a site of interest and their 2D&#x2F;3D coordinates are known</li>
<li>They are implemented on Arduino Pro Mini for the following reasons:<ul>
<li>Arduino Pro Mini’s low power consumption</li>
<li>Anchor’s fast response requirement (order of milliseconds)</li>
<li>Anchor’s simple tasks (receiving and transmitting UWB frames)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>An overall sequence diagram is illustrated below. <code>Tag (Arduino)</code> is actually composed of Arduino Pro Mini and DW1000.</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/sequence.png" class>

<h3><span id="state-machine-tag">State Machine: Tag</span></h3><p>A figure below is a state diagram of a tag:</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/state-tag.png" class>

<p>When a Raspberry Pi commands via I2C to scan, it goes into <code>SCAN</code> state and broadcasts a <code>PING</code> message. Going into <code>PONG</code> state immediately, it waits for <code>PONG</code> messages from anchors nearby for a certain duration. I set it to 100 ms.</p>
<p>If it discovers 3 or more anchors during the <code>PONG</code> state, it goes into <code>ROUNDROBIN</code> state. It exchanges 4 messages with each discovered anchor sequentially, i.e. <code>POLL</code> to an anchor, <code>POLL_ACK</code> from an anchor, <code>RANGE</code> to an anchor, and <code>RANGE_REPORT</code> from an anchor. After sending <code>POLL</code> and <code>RANGE</code> message, it waits for a response message for a certain timeout of 10 ms.</p>
<p>After 4 messages are exchanged with each anchor, it calculates distance between an anchor using Tx&#x2F;Rx timestamp. It adopts two-way ranging algorithm, which is a bit computational intensive, but I think it is not that much intensive. For more information about two-way ranging, please refer the official appliclation note <a target="_blank" rel="noopener" href="https://decawave.com/sites/default/files/aps013_dw1000_and_two_way_ranging_v2.2.pdf">APS013 by DecaWave</a>.</p>
<h3><span id="state-machine-anchor">State Machine: Anchor</span></h3><p>A state diagram of an anchor is simple:</p>
<img src="/2017/08/24/positioning-system-using-decawave-dw1000/state-tag.png" class>

<ul>
<li>It normally stays at <code>IDLE</code> state</li>
<li>If it receives a <code>PING</code> message, it tries to send a <code>PONG</code> message with a random delay between 0 and 90 ms to avoid the collision and goes into <code>PENDING_PONG</code> state</li>
<li>If it receives a <code>POLL</code> message and sends a <code>POLL_ACK</code> message, it goes into <code>RANGE</code> state and waits for a <code>RANGE</code> message is received<ul>
<li>If timeout of 10 ms expires, it returns to <code>IDLE</code> state</li>
<li>If it receives a <code>RANGE</code> message, it sends a <code>RANGE_REPORT</code> message to a tag</li>
</ul>
</li>
</ul>
<h2><span id="implementation">Implementation</span></h2><p>The whole implementation can be found in <a target="_blank" rel="noopener" href="https://github.com/internalstability/dw1000-positioning">my GitHub repository</a>. I used <a target="_blank" rel="noopener" href="https://github.com/thotro/arduino-dw1000">arduino-dw1000</a> for controlling DW1000 using Arduino. I followed wiring between Arduino Pro Mini and DW1000 as defined in <code>examples/Ranging&#123;Anchor,Tag&#125;</code> of the library. Only I2C interface is needed to connect Raspberry Pi and Arduino Pro Mini</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-building-thrift-on-windows-10" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-07-18T00:00:00.000Z"><a href="/2017/07/18/building-thrift-on-windows-10/">2017-07-18</a></time>
      
      
  
    <h1 class="title"><a href="/2017/07/18/building-thrift-on-windows-10/">Building Thrift on Windows 10</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>Contrast to Linux and macOSs, many are having difficult times building and using Thrift on Windows 10. Most Thrift guides on the internet miss some parts. Here’s the correct way to build and use Thrift on Windows 10.</p>
<h2><span id="dependencies">Dependencies</span></h2><ul>
<li>Boost</li>
<li>OpenSSL (for secure socket)</li>
<li>libevent (for callback)</li>
</ul>
<h3><span id="boost">Boost</span></h3><ul>
<li>Download <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/boost/files/boost-binaries/">boost</a>. At this time of writing, the latest version is 1.64.0. I downloaded <code>boost_1_64_0-msvc-14.1-64.exe</code>.<ul>
<li>You must download a correct binary with consideration of OS addressing mode (32&#x2F;64 bits) and MSVC version</li>
<li>You can check MSVC version in a project property page of a  project which will use Thrift</li>
</ul>
</li>
</ul>
<img src="/2017/07/18/building-thrift-on-windows-10/msvc-version.png" class>

<ul>
<li><p>Execute the downloaded file to extract files. In my case, <code>C:\boost_1_64_0</code></p>
</li>
<li><p>Open <code>**Native Tools Command Prompt**</code> and execute the following commands</p>
  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\boost_1_64_0</span><br><span class="line">bootstrap</span><br><span class="line">b2 <span class="literal">--build-type</span>=minimal <span class="literal">--stagedir</span>=stage/x64 ^</span><br><span class="line">   threading=multi link=<span class="keyword">static</span> toolset=msvc<span class="literal">-14</span>.<span class="number">0</span> ^</span><br><span class="line">   variant=release address<span class="literal">-model</span>=<span class="number">64</span> architecture=x86 ^</span><br><span class="line">   <span class="literal">-j8</span></span><br></pre></td></tr></table></figure>

<p>  Options are:</p>
<ul>
<li><code>stagedir</code>: directory to store built files</li>
<li><code>threading=multi</code>: build thread-safe Boost</li>
<li><code>link=static</code>: build static Boost library</li>
<li><code>toolset=msvc-14.0</code>: Visual Studio MSVC (Platform Toolset) used for a project</li>
<li><code>variant=release</code>: Debug&#x2F;Release configuration used for a project</li>
<li><code>address-model=64</code>: addressing mode of your OS</li>
<li><code>architecture=x86</code>: your CPU architecture</li>
</ul>
</li>
</ul>
<h3><span id="openssl">OpenSSL</span></h3><ul>
<li>Download <a target="_blank" rel="noopener" href="https://slproweb.com/products/Win32OpenSSL.html">OpenSSL v1.0.2L binary</a> (not light version)<ul>
<li>v1.1.0 causes an <code>SSLv3_method</code>-related error when building Thrift, at least in my case</li>
<li>Be careful of the addressing mode of your OS</li>
</ul>
</li>
<li>Install OpenSSL by executing the downloaded file. I installed it under <code>C:\OpenSSL-Win64</code></li>
</ul>
<h3><span id="libevent">libevent</span></h3><ul>
<li>Download <a target="_blank" rel="noopener" href="http://libevent.org/">libevent-2.0.22</a> (v2.1.8 has an issue)</li>
<li>Extract it under <code>C\:libevent-2.0.22-stable</code>, or whereever you want</li>
<li>Open <code>**Native Tools Command Prompt**</code> and build it by executing <code>nmake -f Makefile.nmake</code></li>
</ul>
<h2><span id="building-thrift">Building Thrift</span></h2><ul>
<li>Download <a target="_blank" rel="noopener" href="https://github.com/apache/thrift/releases/tag/0.9.2">Thrift 0.9.2</a> (v0.9.3 and later version have an issue) and extract it to somewhere (<code>C:\thrift-0.9.2</code>, in my case)</li>
<li>Open a solution <code>thrift.sln</code> under <code>C:\thrift-0.9.2\lib\cpp</code>. There are two projects: <code>libthrift</code> and <code>libthriftnb</code></li>
<li>Open property pages and adjust <code>Target Platform Version</code> and <code>Platform Toolset</code> as the same as a project which you are working on</li>
<li>Set parameters as the following:<ul>
<li><p><code>libthrift</code></p>
<ul>
<li>C&#x2F;C++ &gt; General &gt; Additional Include Directories<ul>
<li><code>C:\OpenSSL-Win64\include</code>, <code>C:\boost_1_64_0</code></li>
</ul>
</li>
<li>Librarian &gt; All Options<ul>
<li>Additional Dependencies<ul>
<li><code>libeay32.lib</code>, <code>ssleay32.lib</code>, <code>libeay32MT.lib</code>, <code>ssleay32MT.lib</code></li>
</ul>
</li>
<li>Additional Library Directories<ul>
<li><code>C:\OpenSSL-Win64\lib</code>, <code>C:\OpenSSL-Win64\lib\VC\static</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>  Note that you need to add other library files and directories according to static&#x2F;dynamic link and Debug&#x2F;Release configuration</p>
</li>
<li><p><code>libthriftnb</code></p>
<ul>
<li>C&#x2F;C++ &gt; General &gt; Additional Include Directories<ul>
<li><code>C:\libevent-2.0.22-stable\include</code>, <code>C:\libevent-2.0.22-stable\WIN32-Code</code>, <code>C:\libevent-2.0.22-stable</code>, <code>C:\boost_1_64_0</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Build <code>libthrift</code> and <code>libthriftn</code> sequentially</li>
</ul>
<h2><span id="testing-thrift">Testing Thrift</span></h2><ul>
<li><p>Grab the <a target="_blank" rel="noopener" href="https://thrift.apache.org/tutorial/cpp">example code</a> and make a project for each server and client</p>
</li>
<li><p>Get the <a target="_blank" rel="noopener" href="https://archive.apache.org/dist/thrift/0.9.2/">Thrift compiler</a> and compile Thrift definition files above</p>
</li>
<li><p>Set parameters of each project as the following:</p>
<ul>
<li>C&#x2F;C++ &gt; General &gt; Additional Include Directories<ul>
<li><code>C:\boost_1_64_0</code>, <code>C:\thrift-0.9.2\lib\cpp\src\thrift\windows</code>, <code>C:\thrift-0.9.2\lib\cpp\src</code></li>
</ul>
</li>
<li>Linker &gt; All Options<ul>
<li>Additional Dependencies<ul>
<li>libthrift.lib</li>
</ul>
</li>
<li>Additional Library Directories<ul>
<li><p><code>C\:thrift-0.9.2\lib\cpp\x64\Release</code>, <code>C:\boost_1_64_0\stage\x64\lib</code></p>
<p>  Note: you may need to add other directories according to Debug&#x2F;Release configuration</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Build and start a server project and then a client project. You can see Thrift working</p>
</li>
</ul>
<img src="/2017/07/18/building-thrift-on-windows-10/demo.png" class>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article id="post-reading-ranging-data-from-decawave-evk1000" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-05-14T00:00:00.000Z"><a href="/2017/05/14/reading-ranging-data-from-decawave-evk1000/">2017-05-14</a></time>
      
      
  
    <h1 class="title"><a href="/2017/05/14/reading-ranging-data-from-decawave-evk1000/">Reading ranging data from DecaWave EVK1000</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2><span id="decawave-evk1000-and-trek1000">DecaWave EVK1000 and TREK1000</span></h2><p>EVK1000 and TREK1000 are Two-way Ranging Evaluation Kit for DecaWave’s UWB DW1000 chip. You can see and evaluate a ranging result on a screen of each of them. However, to see a positioning result, you need to connect one of them with a PC and use DecaWave’s dedicated software only on Windows. Here’s how to read data from EVK1000 without the dedicated software</p>
<h2><span id="preparing-a-driver">Preparing a Driver</span></h2><p>This kit has a COM (serial) port. But this port is wrapped with USB interface and operates with a virtual COM port driver</p>
<ul>
<li>On Windows, a driver for this (STM32 Virtual ComPort in FS Mode v1.4.0) can be downloaded at here. After downloading and extracting the file, run <code>&lt;OS&gt;/dpinst_&lt;arch&gt;</code>.exe where <code>&lt;OS&gt;</code> and <code>&lt;arch&gt;</code> are your OS and architecture, respectively. A related thread can be found <a target="_blank" rel="noopener" href="http://forum.espruino.com/conversations/290299/">here</a></li>
<li>On Linux and macOS, when a board is connected, a driver will be automatically loaded</li>
</ul>
<p>For more detail, please refer <a target="_blank" rel="noopener" href="http://www.ftdichip.com/Drivers/VCP.htm">FTDI Chip</a></p>
<h2><span id="reading-and-parsing-ranging-data">Reading and Parsing Ranging Data</span></h2><p>Configure anchors and a tag by flipping switches as instruction says, and connect an anchor or a tag with a PC. Since it uses a virtual COM port, serial communication parameters are automatically configured and you don’t need to worry about it</p>
<p>When connection is successful, you can see outputs on a serial port terminal as the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mr 01 000004d1 00000000 00000000 00000000 001e 20 403c403c t7:0</span><br><span class="line">mc 01 0000058c 00000000 00000000 00000000 001f 21 00003fe5 t7:0</span><br><span class="line">mr 01 000004ba 00000000 00000000 00000000 001f 21 403c403c t7:0</span><br><span class="line">mc 01 0000059a 00000000 00000000 00000000 0020 22 000040fd t7:0</span><br><span class="line">mr 01 000004c8 00000000 00000000 00000000 0020 22 403c403c t7:0</span><br><span class="line">mc 01 00000579 00000000 00000000 00000000 0021 23 00004215 t7:0</span><br><span class="line">mr 01 000004a7 00000000 00000000 00000000 0021 23 403c403c t7:0</span><br><span class="line">mc 01 0000059a 00000000 00000000 00000000 0022 24 0000432d t7:0</span><br><span class="line">mr 01 000004c8 00000000 00000000 00000000 0022 24 403c403c t7:0</span><br><span class="line">mc 01 00000574 00000000 00000000 00000000 0023 25 00004445 t7:0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Here, important columns are from the 3rd to 6th, 7th, 8th columns</p>
<ul>
<li>The 3rd to 6th columns represent a range measurement from each anchor 0 to 3 in hexadecimal<ul>
<li>For example, <code>000004d1</code> represents <code>0x4d1</code> or <code>1233</code>, which is 1.233 m.</li>
</ul>
</li>
<li>The 7th column represents a sequence number</li>
<li>The 8th column represents a ranging sequence number</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="jeon.engineer">
  </form>
</div>


  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/antlr4/">ANTLR4</a><small>3</small></li>
  
    <li><a href="/tags/ant-design/">Ant Design</a><small>1</small></li>
  
    <li><a href="/tags/dw1000/">DW1000</a><small>1</small></li>
  
    <li><a href="/tags/dwm1000/">DWM1000</a><small>1</small></li>
  
    <li><a href="/tags/decawave/">DecaWave</a><small>2</small></li>
  
    <li><a href="/tags/evk1000/">EVK1000</a><small>1</small></li>
  
    <li><a href="/tags/github-action/">GitHub Action</a><small>1</small></li>
  
    <li><a href="/tags/hexo/">Hexo</a><small>1</small></li>
  
    <li><a href="/tags/intel/">Intel</a><small>1</small></li>
  
    <li><a href="/tags/react/">React</a><small>1</small></li>
  
    <li><a href="/tags/rust/">Rust</a><small>3</small></li>
  
    <li><a href="/tags/ssl-certificate/">SSL certificate</a><small>1</small></li>
  
    <li><a href="/tags/trek1000/">TREK1000</a><small>1</small></li>
  
    <li><a href="/tags/thrift/">Thrift</a><small>1</small></li>
  
    <li><a href="/tags/uwb/">UWB</a><small>2</small></li>
  
    <li><a href="/tags/wi-fi/">Wi-Fi</a><small>1</small></li>
  
    <li><a href="/tags/axios/">axios</a><small>1</small></li>
  
    <li><a href="/tags/dnd-kit/">dnd kit</a><small>1</small></li>
  
    <li><a href="/tags/optimization/">optimization</a><small>1</small></li>
  
    <li><a href="/tags/positioning/">positioning</a><small>3</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/trilateration/">trilateration</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2024 Seokseong Jeon
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
